# 网络安全基础

## 安全威胁

### 信息安全的目标

1. **保密性**：确保信息不被泄露或呈现给非授权的人

2. **完整性**：确保数据的一致性，特别要防止未经授权的生成、修改或毁坏数据

3. **可用性**：确保合法用户不会无缘无故地被拒绝访问信息或资源

4. **合法使用性**：确保资源不被非授权的人或以非授权的方式使用

### 四个基本威胁

1）信息泄露：信息被泄露给某个非授权的人。这种威胁来自诸如窃听、搭线等信息探测攻击

2）完整性破坏：数据的一致性通过非授权的增删、修改或破坏而受到损坏

3）拒绝服务：对信息或资源的访问无条件地阻止。攻击者通过对系统进行非法的、根本无法成功的访问尝试使得系统产生过量的负荷，从而导致系统的资源在合法用户看来是不可使用的。

4）非法使用：某一资源被某个非授权的人或以某种非授权的方式使用。攻击者侵入某个计算机系统并以此为盗用电信服务的基点，或者作为侵入其他系统的“桥头堡”

### 渗入威胁

假冒，旁路控制，授权侵犯

### 植入威胁：

特洛伊木马，陷门

### 安全防护措施

物理安全：

人员安全：安全意识、雇员的筛选

管理安全：对进口软件/硬件的控制

媒体安全：受保护的信息的存储，敏感信息的记录、销毁和再生

辐射安全：辐射控制

生命周期控制：安全评估可信系统

## 安全策略

### 定义

安全策略指在某个安全域内，施加给**所有**与安全相关活动的一套规则

### 等级划分

安全策略目标

机构安全策略

系统安全策略 （安全策略通常指系统安全策略）

### 访问控制策略的分类

#### 第一种分类方式

- 基于身份的策略:允许或拒绝对明确区分的个体或群体进行访问。
- 基于任务的策略：是基于身份的策略的一种变形，它给每一个个体分配任务，并基于这些任务来使用授权规则。
- 多等级策略：是基于信息敏感性的等级及工作人员许可等级而制定的一般规则的策略。

#### 第二种分类方式

- 强制性访问控制策略：只授予主体执行任务必需的信息或处理能力

- 自主性访问控制策略：按照规则向主体提供机密信息

## 安全攻击的分类

### 被动攻击

- 窃听攻击：攻击者通过窃听可以截获电话，电子邮件中的敏感信息或秘密信息
- 流量分析：攻击者通过流量分析获得消息的模式从而确定通信主机身份与位置，再通过传输频率和长度推断本次通信的性质

### 主动攻击

- 伪装攻击：某个实体假装成其他实体，对目标发起攻击

- 重放攻击：攻击者为了达到某种目的，将获得的信息再次发送，以在非授权的情况下进行传输

- 消息篡改：对所获得的合法消息中的一部分进行修改或延迟消息的传输，以达到其非授权的目的

- 拒绝服务：阻止或禁止人们正常使用网络服务或管理通信设备

### 应对措施

处理被动攻击的重点是预防，处理主动攻击的重点是检测

## 安全体系结构

### X.800的5类安全服务

认证，访问控制，数据保密性，数据完整性，不可否认性

### X.800的5种普遍安全机制

可信功能度，安全标志，事件检测，安全审计跟踪，安全恢复

### X.800的8种特定安全机制

加密，数字签名，访问控制，数据完整性，认证交换，流量填充，路由控制，公证

## 网络安全模型

![5](E:\Documents\网络安全笔记.assets\clip_image002.jpg)

6个功能实体组成：消息的发送方（**信源**）、消息的接收方（**信宿**）、**安全变换**、**信息通道**、**可信的第三方**和**攻击者**。

## PDDR安全模型



![img](https://img2020.cnblogs.com/blog/1358881/202102/1358881-20210209090831880-762644003.png)

1. Policy（安全策略）   

PPDR安全模型的**核心**，描述系统哪些资源需要保护，如何实现保护。

2. Protection（防护）

修复系统漏洞、正确设计开发和安装系统；

定期检测发现可能存在的系统脆弱性；

教育用户和操作员正确使用系统；

访问控制、监视来防止恶意威胁  

加密机制、数字签名机制、访问控制机制、认证机制、信息隐藏、防火墙技术等。

3. Detection（检测）   

检测是动态响应和加强防护的依据，也是强制落实安全策略的有力工具，通过不断检测和监控网络和系统，来发现新的威胁和弱点，通过循环反馈来及时做出有效的相应。

入侵检测、系统脆弱性机制、数据完整性机制、攻击性检测等。

4. Response（响应）   

在安全系统中有最重要的地位，是解决安全潜在问题的最有效的办法，从某种意义上讲，安全问题就是解决紧急响应和异常处理问题。

应急策略、应急机制、应急手段、入侵过程分析、安全状态评估等。



# TCP/IP协议族的安全性

## IP协议

1. 不可靠，**不能保证数据包传送成功**，也**不能保证按特定次序传输**，也**不能校验正确性**。**头部的校验和部分只能用于校验数据包IP头部的正确性**，**没有任何机制保证数据净荷传输的正确性**。**不能保证数据一定是从数据包中所给的源地址发送的,任何一台主机都能发送具有任意源地址的数据包**。
2. IP确认包含一个选项,叫做"IP source routing",用来指定源地址和目标地址之间的直接路径.使用了“IP source routing”这一选项的网际协议的数据包好像总是从路径最后一个系统上传递过来的,而不是来自它的真实地点。
3. 根据IP协议规定、中间节点不能对小数据包进行拼接组合。

## ARP协议(地址解析协议)

将32bit的IP地址(IPv4)转化为48bit的MAC地址

## TCP协议

### 三次握手机制

1. 客户主机发给服务器一个设置了SYN标志位的数据包和一个初始的客户机序号seq=x,在服务器收到初始的SYN数据包后,该连接处于半开放状态

2. 服务器返回给一个确认数据包 SYN seq=y ACK=x+1,等待确认 (数据包既含有SYN标志位,又有ACK信息)

3. 客户主机发送第三个数据包 seq=x+1 ACK=y+1,使得TCP连接开放.客户机和服务器之间建立连接

   ![img](https://img2020.cnblogs.com/blog/1358881/202101/1358881-20210130144040741-1108097612.png)

### SYN Flood攻击

当TCP处于半开放状态时，攻击者使用第一个数据包对服务器进行大流量冲击，使服务器一直处于半开放连接状态，导致服务器无法实现三次握手协议

防范措施:一类通过防火墙，路由器等网关防护，另一类通过TCP/IP协议栈防范



## UDP协议

### 应用

Challenge/Response 类型的应用,如NFS(分布式文件系统)

NTP(网络时间协议) 端口号123

SNMP（简单网络管理协议）端口号161

DNS 端口号53

### 与TCP的区别

1. UDP传输数据时，既没有纠错和重传机制，也没有对数据包进行丢包，复制，重新排列的检查机制，进行大流量的数据传输时会造成路由器堵塞和数据包丢失。
2. UDP忽略了源地址和目的地址
3. UDP没有交换握手信息和序号的过程，因此易受到欺骗

## ICMP协议

- ICMP用来通知主机到达目的地的最佳路由,报告路由故障,因网络故障中断某个连接.

- 是一种差错控制报文协议,不仅用于传输差错报文,还传输控制报文

## 路由协议

![image-20210311163839584](E:\Documents\网络安全笔记.assets\image-20210311163839584.png)

1. 路由协议是一种在Internet上动态寻找恰当路径的机制
2. 路由信息产生两个通道：主叫主机到目标主机，目标主机到主叫，当这两个不互逆时叫做非对称路由（优点：负载均衡 缺点：有多个防火墙引发安全问题）
3. 路由协议的攻击和防范：攻击者通过自封包或修改网络节点的IP地址来冒充某个可信节点的IP地址进行攻击。抛弃外网进来却声称内部主机的报文，关闭路由器的源路由功能
4. 边界网关协议（BGP）:通过TCP连接在路由器之间分配路由信息。
5. 有限开放最短路径协议（OSPF）三个优点

- 验证机制：支持空验证，简单口令验证，加密验证三种方式对路由器之间交换的信息进行验证。
- 扩散机制：链路状态定时刷新，或链路变化时发送，独立计算最佳路径，对错误链路进行反击。
- 分层路由：对其他区域屏蔽使得危害对于整个自治区最小，其他区域路由仍能正常使用。

## 电子邮件协议

1. 简单邮件传输协议（SMTP端口：25）
2. 邮局协议（POP3端口：110）
3.  Internet消息访问协议（IMAP端口：143）

## 消息传输协议

1. 简单文件传输协议（TFTP UDP67）
2. 文件传输协议（FTP）  21端口是控制连接，20端口是数据连接

# 数字证书和公钥基础设施

## PKI公开密钥基础设施

### 定义

PKI是一种遵循标准的利用公钥理论和技术建立的提供安全服务的基础设施

> PKI系统的关键是实现密钥管理。
>
> 目前较好的密钥解决方案是采取证书机制，

### 组成

- 证书机构 CA 

  > 最高权威的CA称为：起始授权机构或权威源（SOA）

  <img src="https://img2020.cnblogs.com/blog/1358881/202101/1358881-20210131151107308-294243903.png" alt="img" style="zoom: 80%;" />

- 注册机构 RA

  <img src="https://img2020.cnblogs.com/blog/1358881/202101/1358881-20210131151142400-98076203.png" alt="img" style="zoom: 67%;" />

- 证书发布库：集中存放CA颁发证书和证书撤销列表（CRL）

- 密钥管理与恢复：密钥管理和恢复只能针对加/解密密钥，**无法对签名密钥进行备份**。

- 证书撤销：通过CRL和OCSP

- PKI应用接口

### 应用

1. 认证服务：先验证**证书**的真伪，在验证**身份**的真伪
2. 数据完整性服务（确认数据没有被修改过）：先用杂凑算法，再用自己的私钥对杂凑值进行加密。
3. 数据保密性服务（**PKI的数字信封机制**）：采用数字证书机制，发送方产生一个对称密钥，并用其加密数据。同时，发送方用接收方的公钥加密对称密钥，将被加密的对称密钥和被加密的数据一起发送给接收方，接收方用自己的私钥解开得到对称密钥，用对称密钥得到敏感数据。
4. 不可否认服务：从技术上保证实体对其行为的认可。
5. 公证服务：证明数据的有效性和正确性。

## 数字证书

### 概念

- 数字证书是一个**用户的身份**与其所持有的**公钥**的结合，在结合之前由一个可信任的权威机构CA来证实用户的身份，然后由该机构对该用户身份及对应公钥相结合的证书进行数字签名，以证明其证书的有效性。

- 数字证书是一个经证书认证中心(CA)数字签名的包含公开密钥拥有者信息以及公开密钥的文件

- **数字证书的组成**：主体名，序号，有效期，签发者名，公钥，版本，签名算法标识符。
- **数字证书参与方**：证书机构CA、注册机构RA、最终用户



### 数字证书的结构

![img](https://img2020.cnblogs.com/blog/1358881/202101/1358881-20210131153337756-877494461.png)

### 数字证书生成步骤



![img](https://img2020.cnblogs.com/blog/1358881/202101/1358881-20210131154220638-1118401909.png)

### 数字证书的撤销

#### **证书撤销的原因：**

1. 数字证书持有者报告证书的指定公钥对应的私钥**被破解**，需由证书持有者进行证书**撤销申请**
2. CA签发数字证书时出错，CA启动证书撤销
3. 证书持有者离职，而证书时在离职期间签发，由组织提出证书撤销申请

#### 撤销机制

- CRL

  **证书撤销列表**，是**脱机证书撤销状态检查**的主要方法。他只列出来在有效期内的因故被撤销的证书，而不是所有。**差异CRL都需要CA的签名**。

  撤销列表CRL需要包含CRL发布时间、版本、每个证书的撤销时间、撤销原因，以及发放者的数字签名等。

- OCSP

  **联机证书状态协议OCSP**可以检查特定时刻某个数字证书是否有效，是联机检查方案

OCSP联机证书状态协议 缺点

1. 缺少对当前证书相关的证书链的有效期的检查，需要客户机应用程序的辅助
2. 客户机应用程序还要检查证书的有效期，密钥使用合法性和其他限制



## PMI----授权管理设施

PMI是属性证书、属性权威、属性证书库等部件的集合体，用来实现权限和证书的产生、管理、存储、分发和撤销等功能。

1. AA：属性权威：生成并签发属性证书的机构，并负责管理属性证书的整个生命周期
2. AC：属性证书

### PMI和PKI

1. 授权信息与公钥实体的生存周期不同
2. 对授权信息来说，身份证书的签发者通常不具有权威性，导致其需要使用额外步骤从权威源获取信息
3. 对于同一实体可由不同属性权威颁发属性证书，赋予不同的权限

![img](https://img2020.cnblogs.com/blog/1358881/202103/1358881-20210309103818264-165590217.png)

# 网络加密与密钥管理

## 加密方式

### 链路加密=在线加密

- 在每一个中间传输节点上，消息均被解密后重新进行加密 （在每个节点上是明文）
- 报文和报头可同时进行加密

### 节点加密

- 不允许消息在网络节点上以明文形式存在
- 报头和路由信息以明文形式传输

### 端到端加密=脱线加密=包加密

- 从源点到终点的传输过程中始终以密文形式存在
- 无法掩盖被传输消息的源点和终点



## 密钥管理

### 种类

![img](https://img2020.cnblogs.com/blog/1358881/202102/1358881-20210202085416229-303049002.png)

1. 基本密钥：kp（Base Key），在较长时间由一对用户专用的密钥 **需要频繁更换**
2. 会话密钥：ks（Session Key），两个通信终端用户在一次通话或交换数据时所用的密钥
3. 密钥加密密钥：ke（Key Encrypting Key），用于对传送的会话或文件加密进行加密的密钥
4. 主机主密钥：km（Host Master Key），对密钥加密密钥进行加密的密钥，存于主机处理器中
5. 数据加密密钥：也称为工作密钥。
6. 在双钥体制下,有公钥和私钥、签名密钥和证实密钥之分

### 密钥认证的分类

1. 隐式密钥认证
2. 密钥确证
3. 显式密钥认证

## 密钥分配

### 密钥分配的方法

1. 利用安全信道实现密钥传递
2. 利用双钥体系建立安全信道传递
3. 利用特定的物理现象（量子传递）实现密钥传递

### 密钥分配的模式

1. 点对点密钥分配
2. 密钥分配中心
3. 密钥转递中心

### 可信第三方TTP

#### 三种工作模式：

- 协调（In line） 当A和B属于不同的安全区域时，协调方式特别重要。

- 联机（On line）

- 脱机（Off line）证书发送管理机构常采用脱机方式。脱机方式对计算资源的要求较低，但在撤销权宜上不如其他两种方式方便。

![img](https://img2020.cnblogs.com/blog/1358881/202102/1358881-20210202091256819-636388181.png)

在协调方式下，T是一个**中间人**，为A与B之间通信提供实时服务；

在联机方式下，T实时参与A和B每次协议的执行，但A和B之间的通信不必经过T；

在脱机方式下，T不实时参与A和B的协议，而是预先向A和B提供双方执行协议所需的信息。

#### TTP功能

- 密钥服务器
- 密钥管理设备
- 密钥查阅服务
- 时戳代理
- 仲裁代理
- 托管代理

### 密钥交换协议

1. 采用单钥体制的密钥建立协议：通信双方需要依赖Trent，他的安全性也完全依赖于Trent，Trent可能成为影响系统性能的瓶颈。
2. 采用双钥体制的密钥交换协议：通信双方的公钥被可信第三方签名后存入数据库中。**不能阻挡中间人攻击。**
3. 联锁协议（一半密文传输）：可以抵挡中间人攻击，中间人既不能对一半密文解密，也不能用一方的公钥加密。
4. 采用数字签名的密钥交换：可以防止中间人攻击
5. 密钥和消息广播：与多人通信
6. **Diffie-hellman密钥交换协议：不能抵抗中间人攻击，没有对通信双方的身份进行验证。******

### 认证的密钥交换协议

- 基于单钥体制的交换协议 如Kerberos协议
- 基于双钥体制的密钥交换协议 如Diffie-hellman
- 基于混合体制的密钥交换协议 如EKE













